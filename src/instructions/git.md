# Git

Версионное хранение реализовано на основе [Git поддержки в платформе][1].

::: warning <span class='iconify' data-icon='emojione-v1:warning' style='color: #e7c000; font-size: 24px;'></span>
Пользователь, совершающий операции, должен иметь соответствующие [разрешения][2].
:::

::: warning <span class='iconify' data-icon='emojione-v1:warning' style='color: #e7c000; font-size: 24px;'></span>
Целевой Git репозиторий должен быть предварительно создан пользователем.
:::

::: tip <span class='iconify' data-icon='mdi:information' style='color: #42b983; font-size: 24px;'></span>
С видео примером можно ознакомиться в разделе [видео](./video.md).
:::

## Подключить проект

- [Открыть][3] необходимый проект.

- В [панели управления проектом][4] выбрать <span class="iconify-inline" data-icon="mdi:git"></span>**История проекта** для перехода в раздел **Синхронизация с Git**.

- В поле ввода **Адрес репозитория Git (в формате SSH)** ввести адрес существующего инициализированного Git репозитория.

  > Пример: git@github.com:user/project.git

- Сохранить адрес нажатием кнопки <span class='iconify-inline' data-icon='mdi:content-save'></span>.

  Ниже адресной строки появится ссылка на раздел в Git репозитории, в котором требуется добавить SSH ключ.

- Нажать на кнопку <span class='iconify-inline' data-icon='mdi:key'></span> **СКОПИРОВАТЬ ПУБЛИЧНЫЙ SSH КЛЮЧ** - для копировать в буфер обмена публичного SSH ключа.

- [Добавить ключ развертывания][5] в целевом репозитории.

### Добавление ключей развертывания

#### GitHub

Ключ, возвращаемый кнопкой <span class='iconify-inline' data-icon='mdi:key'></span> **СКОПИРОВАТЬ ПУБЛИЧНЫЙ SSH КЛЮЧ**, должен быть добавлен разделе **Settings** в качестве ключа развертывания (Deploy key) с правами на запись (<span class="iconify-inline" data-icon="mdi:checkbox-marked" style="color: blue"></span>Allow write access) в соответствующий [GitHub][6] репозиторий.

![Git](/images/common/git_keys.png)

#### GitLab

Ключ, возвращаемый кнопкой <span class='iconify-inline' data-icon='mdi:key'></span> **СКОПИРОВАТЬ ПУБЛИЧНЫЙ SSH КЛЮЧ**, должен быть добавлен в разделе **Settings/Repository** в качестве ключа развертывания (Deploy keys) с правами на запись (<span class="iconify-inline" data-icon="mdi:checkbox-marked" style="color: blue"></span>Grant write permissions to this key) в соответствующий [GitLab][7] репозиторий.

![Git](/images/common/gitlab_keys.png)

## Сохранить новую версию

- [Открыть][3] необходимый проект.

- В [панели управления проектом][4] выбрать <span class="iconify-inline" data-icon="mdi:git"></span>**История проекта** для перехода в раздел **Синхронизация с Git**.

- В разделе **Сохранить текущее состояние проекта** ввести:
  - Краткое описание версии
  - Расширенное описание версии (необязательно)
  - Нажать кнопку **СОХРАНИТЬ**.
  - Дождаться завершения операции в разделе **История операций** и появления новой версии в **История изменений**.

## Восстановить версию

::: tip <span class='iconify' data-icon='mdi:information' style='color: #42b983; font-size: 24px;'></span>
Восстановление ранних версий проекта, в которых отсутствуют позднее созданные узлы, безопасно. Пакеты и задачи этих узлов не будут удалены из проекта.
:::

::: danger <span class='iconify' data-icon='gg:danger' style='color: #cc0000; font-size: 24px;'></span>
Внимание! Если узел был удален пользователем самостоятельно, то при восстановлении версии, которая содержит данный узел, узел будет восстановлен без пакетов и заданий!
:::

- [Открыть][3] необходимый проект.

- В [панели управления проектом][4] выбрать <span class="iconify-inline" data-icon="mdi:git"></span>**История проекта** для перехода в раздел **Синхронизация с Git**.

- В разделе **История изменений** выбрать необходимую версию.
- Нажать кнопку <span class='iconify-inline' data-icon='mdi:backup-restore'></span> восстановления версии.
- Нажать кнопку **ОК** в диалоге подтверждения восстановления версии.
- Дождаться завершения операции в разделе **История операций**.

## Синхронизировать с репозиторием

Для синхронизации истории изменений платформы с состоянием внешнего Git репозитория необходимо:
- Нажать кнопку синхронизации <span class='iconify-inline' data-icon='mdi:refresh'></span> в разделе **История изменений**
- Дождаться завершения операции в разделе **История операций**.

::: tip <span class="iconify" data-icon="mdi:information" style="color: #42b983; font-size: 24px;"></span>
Удаление данных из Git репозитория не производится.
:::

## Отключить синхронизацию

Для отключения синхронизации необходимо:
1. Очистить поле ввода **Адрес репозитория Git (в формате SSH)**.
2. Нажать кнопку сохранения  <span class='iconify-inline' data-icon='mdi:content-save'></span>.
3. Подтвердить необходимость смены адреса в открывшемся окне подтверждения.

  ::: tip <span class="iconify" data-icon="mdi:information" style="color: #42b983; font-size: 24px;"></span>
  При отключении синхронизации удаляются только данные на платформе (история изменений и операций).

  Удаление данных из Git репозитория не производится.

  При повторном подключении ранее отключенного репозитория после выполнения операции синхронизации история изменений на платформе будет заново заполнена.
  :::


[1]: /desc/git.md
[2]: /desc/git.md#разрешения
[3]: ./project.md#открытие-проекта
[4]: /desc/project.md#панель-управления-проектом
[5]: #добавление-ключеи-развертывания
[6]: htts://github.com
[7]: htts://gitlab.com
